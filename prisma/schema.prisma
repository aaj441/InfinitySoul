// InfinitySol Database Schema
// Generated by consolidation script

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================================================
// CONSULTANT SITE MODELS
// ============================================================================

model ConsultantSite {
  id              String   @id @default(uuid())
  subdomain       String   @unique
  consultantEmail String
  brandName       String
  customLogo      String?
  customColors    Json?
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("consultant_sites")
}

// ============================================================================
// EVIDENCE VAULT MODELS
// ============================================================================

model EvidenceFile {
  id          String   @id @default(uuid())
  type        String   // 'scan_report', 'vpat', 'certificate', 'screenshot'
  filePath    String   // S3 path
  fileName    String
  fileSize    Int?
  mimeType    String?
  customerId  String
  uploadedBy  String?
  uploadedAt  DateTime @default(now())

  metadata    Json?    // Additional file metadata

  @@map("evidence_files")
  @@index([customerId])
  @@index([type])
}

// ============================================================================
// AUTOMATION MODELS
// ============================================================================

model AutomationJob {
  id          String   @id @default(uuid())
  type        String   // 'email', 'vpat', 'lead_import'
  status      String   @default("pending") // 'pending', 'processing', 'completed', 'failed'
  payload     Json     // Job-specific data
  result      Json?    // Job results
  error       String?  // Error message if failed
  retryCount  Int      @default(0)
  maxRetries  Int      @default(3)
  createdAt   DateTime @default(now())
  startedAt   DateTime?
  completedAt DateTime?

  @@map("automation_jobs")
  @@index([type])
  @@index([status])
  @@index([createdAt])
}

// ============================================================================
// SCAN RESULTS (Enhanced)
// ============================================================================

model ScanResult {
  id                    String   @id @default(uuid())
  url                   String
  auditId               String   @unique
  status                String   // 'success', 'failed'

  // Violation counts
  criticalCount         Int      @default(0)
  seriousCount          Int      @default(0)
  moderateCount         Int      @default(0)
  minorCount            Int      @default(0)
  totalCount            Int      @default(0)

  // Risk analysis
  riskScore             Float?
  estimatedLawsuitCost  Float?
  industry              String?

  // Raw data
  violationsData        Json?    // Full axe-core results

  // Metadata
  scannedAt             DateTime @default(now())
  email                 String?

  @@map("scan_results")
  @@index([url])
  @@index([scannedAt])
  @@index([email])
}

// ============================================================================
// LEADS (For tracking potential customers)
// ============================================================================

model Lead {
  id            String   @id @default(uuid())
  email         String   @unique
  companyName   String?
  website       String?
  industry      String?

  // Lead source
  source        String?  // 'scan', 'insurance_api', 'manual'

  // Engagement
  lastContactAt DateTime?
  status        String   @default("new") // 'new', 'contacted', 'qualified', 'customer', 'lost'

  // Metadata
  metadata      Json?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("leads")
  @@index([email])
  @@index([status])
}

// ============================================================================
// PHASE III — RISK UNDERWRITING ENGINE
// ============================================================================

// Compliance Credit Score (CCS v2.0) - Like FICO but for ADA/WCAG
model ComplianceScore {
  id                    String   @id @default(uuid())
  scanResultId          String   @unique

  // The score (0-850)
  score                 Int      // 0-850 scale
  grade                 String   // 'A+', 'A', 'B', 'C', 'D', 'F'

  // Score components
  technicalDebtScore    Float    // 0-100, impact of violations
  jurisdictionRisk      Float    // 0-100, legal risk by jurisdiction
  serialPlaintiffRisk   Float    // 0-100, threat from serial plaintiffs
  improvementTrend      Float    // 0-100, velocity of fixes
  industryAdjustment    Float    // 0-100, compared to industry peers

  // Scoring breakdown
  violationCount        Int      // Total violations
  criticalViolations    Int      // WCAG AA failures
  seriousViolations     Int      // WCAG A failures

  // Risk factors
  publicLawsuitCount    Int      @default(0)  // Historical lawsuits
  serialPlaintiffScore  Float    @default(0)  // Risk from known plaintiffs
  cmsRisk               Float    @default(0)  // Platform (WordPress, etc) risk
  trafficMagnitude      Int      @default(0)  // Monthly visitors
  revenuePerVisitor     Float    @default(0)  // Annual revenue / traffic

  // Historical tracking
  previousScore         Int?     // Score from 30 days ago
  trendDirection        String   @default("stable") // 'improving', 'worsening', 'stable'

  // Metadata
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@map("compliance_scores")
  @@index([score])
  @@index([createdAt])
}

// Multi-engine accessibility scan with consensus
model AccessibilityScanConsensus {
  id                    String   @id @default(uuid())
  scanResultId          String   @unique

  // Scan details
  url                   String
  domain                String
  scanDate              DateTime @default(now())

  // Engine results (stored as JSON for flexibility)
  axeResults            Json?    // axe-core results
  pa11yResults          Json?    // Pa11y results
  waveResults           Json?    // WAVE API results
  lighthouseResults     Json?    // Lighthouse accessibility results

  // Consensus violations
  consensusViolations   Json     // Violations agreed upon by 2+ engines
  criticalConsensus     Int      @default(0)
  majorConsensus        Int      @default(0)
  minorConsensus        Int      @default(0)

  // Confidence scores
  avgConfidence         Float    // Average engine confidence

  // Execution details
  executionTimeMs       Int?     // Time to run all engines
  allEnginesSuccessful  Boolean  @default(false)

  // Metadata
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@map("accessibility_scan_consensus")
  @@index([domain])
  @@index([scanDate])
}

// Insurance-grade risk assessment
model RiskAssessment {
  id                        String   @id @default(uuid())
  scanResultId              String   @unique
  complianceScoreId         String   @unique

  // Lawsuit probability
  annualLawsuitProbability  Float    // 0.0-1.0 (0%-100%)

  // Financial exposure
  expectedLawsuitCost       Int      // Settlement + legal fees
  estimatedSettlementLow    Int
  estimatedSettlementMid    Int
  estimatedSettlementHigh   Int
  estimatedLegalFeesLow     Int
  estimatedLegalFeesHigh    Int
  totalExposureLow          Int
  totalExposureHigh         Int

  // Insurance pricing
  recommendedInsurancePremium Int   // Annual premium recommendation
  recommendedRemediationBudget Int // Cost to fix issues

  // Risk factors
  industryRiskScore         Float    // 0-1.0
  jurisdictionRiskScore     Float    // 0-1.0
  plaintiffHistoryScore     Float    // 0-1.0
  violationSeverityScore    Float    // 0-1.0

  // Comparable cases
  comparableCasesCount      Int      @default(0)
  averageSettlementAmount   Int?
  mediaExposureRisk         String?  // 'high', 'medium', 'low'

  // Assessment quality
  assessmentConfidence      Float    // 0-1.0
  lastReassessmentDate      DateTime?

  // Metadata
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt

  @@map("risk_assessments")
  @@index([annualLawsuitProbability])
  @@index([createdAt])
}

// Risk profile for continuous monitoring
model RiskProfile {
  id                    String   @id @default(uuid())

  // Domain identification
  domain                String   @unique
  url                   String

  // Organization info
  companyName           String?
  industry              String?
  estimatedTraffic      Int?     // Monthly visitors
  estimatedRevenue      Float?   // Annual revenue

  // Current risk scores
  currentCcsScore       Int?     // Latest CCS score
  currentProbability    Float?   // Current lawsuit probability
  currentExposure       Int?     // Current estimated exposure

  // Historical tracking
  scoringHistory        Json     @default("[]") // Array of { date, score, probability, exposure }
  violationTrend        String   @default("neutral") // 'improving', 'worsening', 'neutral'

  // Risk factors
  publicLawsuits        Int      @default(0)
  knownSerialPlaintiffs Boolean  @default(false)
  regulatoryFocus       Boolean  @default(false) // Under DOJ/CFPB scrutiny
  mediaAttention        Boolean  @default(false)

  // Monitoring
  monitoringEnabled     Boolean  @default(true)
  monitoringFrequency   String   @default("weekly") // 'daily', 'weekly', 'monthly'
  lastScanDate          DateTime?
  nextScheduledScan     DateTime?

  // Insurance metadata
  insurancePartner      String?
  insurancePolicy       String?
  insuranceExpiresAt    DateTime?

  // Metadata
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@map("risk_profiles")
  @@index([currentCcsScore])
  @@index([domain])
  @@index([industry])
  @@index([lastScanDate])
}

// ============================================================================
// PHASE V — AUTONOMOUS ADA THREAT INTELLIGENCE NETWORK
// ============================================================================

// Real-time lawsuit tracking from PACER, CourtListener, etc.
model Lawsuit {
  id                    String   @id @default(uuid())

  // Case identifiers
  caseNumber            String   @unique
  court                 String   // Federal district, state court
  jurisdiction          String   // State abbreviation

  // Parties
  plaintiff             String
  plaintiffAttorney     String?
  defendant             String   // Domain or company
  defendantSize         String?  // 'startup', 'smb', 'mid-market', 'enterprise'

  // Case details
  violationTypes        String[] // WCAG violations alleged
  filedDate             DateTime
  status                String   // 'filed', 'settled', 'judgment', 'dismissed'
  settlementAmount      Int?
  legalFeesPaid         Int?

  // Risk signals
  industry              String?
  isSocialMedia         Boolean  @default(false)
  isRetail              Boolean  @default(false)
  isEcommerce           Boolean  @default(false)
  isHealthcare          Boolean  @default(false)
  isEducation           Boolean  @default(false)

  // Intelligence
  serialPlaintiff       Boolean  @default(false)
  aggressiveAttorney    Boolean  @default(false)
  mediaAttention        Boolean  @default(false)

  // Source & metadata
  source                String   // 'PACER', 'CourtListener', 'News'
  sourceUrl             String?
  fetchedAt             DateTime @default(now())
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@map("lawsuits")
  @@index([defendant])
  @@index([jurisdiction])
  @@index([filedDate])
  @@index([plaintiffAttorney])
  @@index([serialPlaintiff])
}

// Serial plaintiff profile with behavioral data
model SerialPlaintiff {
  id                    String   @id @default(uuid())

  // Profile
  name                  String   @unique
  lawFirm               String?
  attorneyNames         String[]

  // Activity metrics
  totalFilings          Int      @default(0)
  settlementsWon        Int      @default(0)
  winRate               Float    @default(0.0) // 0-1.0
  averageSettlement     Int?     // Average settlement amount

  // Targeting patterns
  preferredJurisdictions String[]
  preferredIndustries   String[]
  targetCompanySizes    String[] // 'startup', 'smb', etc.
  targetCMS             String[] // 'WordPress', 'Shopify', etc.

  // Behavior signals
  filingVelocity        Int      @default(0) // Lawsuits per month
  jurisdictionExpansion Boolean  @default(false)
  partnershipChanges    Boolean  @default(false)

  // Threat level
  threatLevel           String   @default("medium") // 'critical', 'high', 'medium', 'low'
  lastActivityDate      DateTime?
  nextPredictedTarget   String?  // Domain or company name

  // Metadata
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@map("serial_plaintiffs")
  @@index([name])
  @@index([threatLevel])
  @@index([preferredIndustries])
}

// Industry-wide litigation heatmap
model IndustryLitigationRisk {
  id                    String   @id @default(uuid())

  // Industry info
  industry              String   @unique // e.g., 'retail', 'ecommerce', 'saas'

  // Risk metrics
  litigationDensity     Float    // Lawsuits per 10K companies per year
  recentFilingCount     Int      // Lawsuits in past 90 days
  totalFilingsThisYear  Int

  // Trends
  trend                 String   @default("stable") // 'rising', 'falling', 'stable'
  trendDirection        Int      @default(0) // -1 = falling, 0 = stable, +1 = rising

  // Threat intelligence
  dominantPlaintiffs    String[] // Top 3 serial plaintiffs
  commonViolations      String[] // Most-sued violations
  averageSettlement     Int?

  // Predictive signals
  forecasted30DayFilings Int?
  forecasted90DayFilings Int?

  // Metadata
  lastUpdated           DateTime @default(now())
  dataSource            String   // 'PACER', 'aggregated'

  @@map("industry_litigation_risk")
  @@index([industry])
  @@index([trend])
  @@index([litigationDensity])
}

// Jurisdiction-level threat assessment
model JurisdictionThreat {
  id                    String   @id @default(uuid())

  // Location
  state                 String   @unique // CA, NY, FL, etc.
  federalCircuit        String?

  // Litigation metrics
  annualLawsuitCount    Int      @default(0)
  activeSerialPlaintiffs Int     @default(0)
  averageSettlement     Int?
  plaintiff wins         Float    @default(0.5) // 0-1.0

  // Risk assessment
  threatLevel           String   @default("medium") // 'critical', 'high', 'medium', 'low'
  heating                Boolean  @default(false) // Is litigation rising?
  litigationTrend       String   @default("stable") // 'rising', 'falling', 'stable'

  // Trend data
  litigationVelocity    Int      @default(0) // New lawsuits per month
  recent30DayFilings    Int      @default(0)
  recent90DayFilings    Int      @default(0)

  // Plaintiff activity
  activePlaintiffNames  String[]
  aggressiveLawFirms    String[]

  // Metadata
  lastUpdated           DateTime @default(now())
  flaggedForEscalation  Boolean  @default(false)

  @@map("jurisdiction_threats")
  @@index([state])
  @@index([threatLevel])
  @@index([heating])
}

// Lawsuit prediction model outputs
model LawsuitPrediction {
  id                    String   @id @default(uuid())

  // Target
  domain                String
  companyName           String?
  industry              String?
  jurisdiction          String?

  // Probability predictions
  probability30Days     Float    // 0.0-1.0
  probability90Days     Float
  probability1Year      Float

  // Feature importance (what drives the prediction)
  violationTrendScore   Float
  industryRiskScore     Float
  jurisdictionRiskScore Float
  plaintiffProximityScore Float
  cmsRiskScore          Float

  // Prediction metadata
  confidence            Float    // 0.0-1.0
  riskRating            String   // 'critical', 'high', 'medium', 'low'
  predictedPlaintiffs   String[] // Top 3 likely plaintiffs
  predictedSettlement   Int?     // Estimated if sued

  // Model version
  modelVersion          String   @default("v3.0")
  predictedAt           DateTime @default(now())
  nextUpdateAt          DateTime?

  @@map("lawsuit_predictions")
  @@index([domain])
  @@index([probability30Days])
  @@index([riskRating])
  @@index([predictedAt])
}

// Portfolio-level risk aggregation for insurers/law firms
model PortfolioRiskAssessment {
  id                    String   @id @default(uuid())

  // Portfolio info
  portfolioName         String
  ownerType             String   // 'law_firm', 'insurer', 'agency'
  ownerName             String?
  clientCount           Int      @default(0)

  // Aggregate metrics
  totalExposure         Int      // Sum of all client exposures
  expectedClaimsPerYear Float
  averageComplianceScore Int?
  averageLitigationProbability Float?

  // Risk distribution
  criticalRiskCount     Int      @default(0) // Clients in critical risk
  highRiskCount         Int      @default(0)
  mediumRiskCount       Int      @default(0)
  lowRiskCount          Int      @default(0)

  // Clustered risks
  litigationClusterRisk Boolean  @default(false) // Multiple clients at risk
  jurisdictionHotspots  String[]
  industryHotspots      String[]

  // Insurer-relevant metrics
  estimatedTotalClaims  Int?
  recommendedPremium    Int?
  lossReductionOpportunity Int?

  // Remediation priorities
  urgentRemediationCount Int      @default(0) // Clients needing immediate fixes

  // Metadata
  lastUpdated           DateTime @default(now())
  nextAssessment        DateTime?

  @@map("portfolio_risk_assessments")
  @@index([ownerType])
  @@index([totalExposure])
  @@index([litigationClusterRisk])
}

// Global threat intelligence pulse
model ThreatIntelligencePulse {
  id                    String   @id @default(uuid())

  // Global metrics
  globalRiskIndex       Int      // 0-100 scale
  litigationActivityLevel String  // 'surging', 'elevated', 'normal', 'quiet'
  serialPlaintiffActivityLevel String

  // Industry breakdown
  industryRiskSnapshot  Json     // { industry: threatLevel }
  jurisdictionRiskSnapshot Json   // { state: threatLevel }

  // Alerts
  activeAlerts          Int      @default(0)
  emergingThreats       String[] // Industries/jurisdictions to watch
  riskTrends            String[] // 'retail-surge', 'saas-stable', etc.

  // Predictions
  forecast30Days        Int?     // Predicted lawsuits in next 30 days
  forecast90Days        Int?

  // Metadata
  pulseTime             DateTime @default(now())
  dataQuality           Float    // 0.0-1.0
  sourceCount           Int      // Number of data sources aggregated

  @@map("threat_intelligence_pulses")
  @@index([pulseTime])
  @@index([globalRiskIndex])
}

// ============================================================================
// PHASE VII — ENTERPRISE CASE MANAGEMENT & LITIGATION WORKFLOW
// ============================================================================

// Full litigation case tracking with document management
model LitigationCase {
  id                    String   @id @default(uuid())

  // Case identifiers
  caseNumber            String   @unique
  court                 String
  jurisdiction          String
  assignedJudge         String?

  // Parties
  plaintiff             String
  plaintiffAttorney     String
  defendant             String
  defendantAttorney     String?

  // Case status
  status                String   // 'filed', 'discovery', 'motion', 'trial', 'appeal', 'settled', 'dismissed'
  statusHistory         Json     // { date, from, to, reason }[]
  priority              String   @default("medium") // 'critical', 'high', 'medium', 'low'

  // Violations
  violationTypes        String[]
  violationSeverity     String[] // 'critical', 'serious', 'moderate', 'minor'
  claimsCount           Int      @default(0)

  // Demand & Settlement
  initialDemand         Int?
  currentDemand         Int?
  ourOffer              Int?
  currentSettlement     Int?

  // Important dates
  filedDate             DateTime
  serviceDate           DateTime?
  answeredDate          DateTime?
  discoveryDeadline     DateTime?
  motionDeadline        DateTime?
  trialDate             DateTime?
  settlementDate        DateTime?

  // Financial
  estimatedExposure     Int?
  legalFeesBudget       Int?
  spentToDate           Int?

  // AI Analysis
  caseStrengthScore     Float?   // 0.0-1.0 our odds
  recommendedStrategy   String?
  aiAssessment          Json?    // AI case analysis

  // Documents
  documents             CaseDocument[]
  timeline              CaseTimeline[]
  stakeholders          CaseStakeholder[]
  workflow              CaseWorkflow?
  updates               CaseUpdate[]

  // Metadata
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@map("litigation_cases")
  @@index([caseNumber])
  @@index([status])
  @@index([defendant])
  @@index([filedDate])
}

// Case documents with versioning
model CaseDocument {
  id                    String   @id @default(uuid())
  caseId                String
  case                  LitigationCase @relation(fields: [caseId], references: [id], onDelete: Cascade)

  // Document details
  title                 String
  documentType          String   // 'complaint', 'answer', 'motion', 'brief', 'discovery', 'exhibit', 'demand', 'response'
  description           String?
  filePath              String   // S3 path

  // Content
  content               String?  // Full text if extracted
  pageCount             Int?
  hash                  String?  // Document integrity verification

  // Metadata
  fileSize              Int?
  mimeType              String?
  uploadedBy            String
  uploadedAt            DateTime @default(now())

  // Versioning
  version               Int      @default(1)
  previousVersionId     String?

  // AI Analysis
  extractedText         String?  // OCR text
  keyPhrases            String[]
  sentiment             String?  // 'favorable', 'neutral', 'unfavorable'

  // Indexing for search
  searchable            Boolean  @default(true)
  tags                  String[]

  @@map("case_documents")
  @@index([caseId])
  @@index([documentType])
  @@index([uploadedAt])
}

// Case timeline - visual event tracking
model CaseTimeline {
  id                    String   @id @default(uuid())
  caseId                String
  case                  LitigationCase @relation(fields: [caseId], references: [id], onDelete: Cascade)

  // Event
  eventType             String   // 'filing', 'service', 'response', 'motion', 'hearing', 'discovery', 'settlement'
  eventDate             DateTime
  eventTitle            String
  eventDescription      String?

  // Importance
  isDeadline            Boolean  @default(false)
  isMilestone           Boolean  @default(false)
  priority              String   @default("normal")

  // Related data
  relatedDocumentId     String?
  relatedPlaintiffAction Boolean @default(false)

  // Metadata
  createdAt             DateTime @default(now())

  @@map("case_timelines")
  @@index([caseId])
  @@index([eventDate])
}

// Case stakeholders - team management
model CaseStakeholder {
  id                    String   @id @default(uuid())
  caseId                String
  case                  LitigationCase @relation(fields: [caseId], references: [id], onDelete: Cascade)

  // Stakeholder
  name                  String
  role                  String   // 'lead_counsel', 'paralegal', 'expert', 'in_house_counsel', 'litigation_support'
  email                 String
  phone                 String?

  // Team assignment
  assignedAt            DateTime @default(now())
  responsibilities      String[]
  availability          String   @default("full_time") // 'full_time', 'part_time', 'as_needed'

  @@map("case_stakeholders")
  @@index([caseId])
  @@index([role])
}

// Case workflow - task management
model CaseWorkflow {
  id                    String   @id @default(uuid())
  caseId                String   @unique
  case                  LitigationCase @relation(fields: [caseId], references: [id], onDelete: Cascade)

  // Workflow state
  currentPhase          String   // 'intake', 'investigation', 'discovery', 'motion', 'trial_prep', 'trial', 'settlement', 'appeal'
  completedPhases       String[]

  // Tasks
  tasks                 Json     // { id, title, status, dueDate, assignee, priority }[]
  tasksCompletedCount   Int      @default(0)
  tasksOverdueCount     Int      @default(0)

  // Automation
  automationRules       Json?    // Auto-generated tasks, notifications
  nextAutomatedAction   String?
  nextAutomatedActionDate DateTime?

  // Metadata
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@map("case_workflows")
  @@index([caseId])
  @@index([currentPhase])
}

// Case updates - activity log
model CaseUpdate {
  id                    String   @id @default(uuid())
  caseId                String
  case                  LitigationCase @relation(fields: [caseId], references: [id], onDelete: Cascade)

  // Update
  updateType            String   // 'status_change', 'document_added', 'meeting_scheduled', 'strategy_update', 'financial_update', 'alert'
  title                 String
  description           String?

  // Actor
  updatedBy             String   // Email or system
  isSystemGenerated     Boolean  @default(false)

  // Metadata
  createdAt             DateTime @default(now())

  @@map("case_updates")
  @@index([caseId])
  @@index([updateType])
  @@index([createdAt])
}

// ============================================================================
// PHASE VIII — ADVANCED LEGAL REASONING ENGINE
// ============================================================================

// AI-generated legal opinions with citations
model LegalOpinion {
  id                    String   @id @default(uuid())

  // Opinion
  title                 String
  opinionType           String   // 'case_analysis', 'legal_memorandum', 'expert_opinion', 'settlement_analysis'
  content               String   // Full opinion text
  summary               String

  // Legal basis
  jurisdiction          String
  applicableLaws        String[]
  keyStatutes           String[]
  precedents            String[]

  // AI reasoning
  reasoning             Json     // Structured reasoning chain
  confidence            Float    // 0.0-1.0
  citationQuality       Float    // How well cited (0.0-1.0)

  // Related data
  caseId                String?
  relatedCases          String[] // Case numbers

  // Expert review
  reviewedByAttorney    Boolean  @default(false)
  reviewerName          String?
  reviewNotes           String?

  // Metadata
  generatedAt           DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@map("legal_opinions")
  @@index([opinionType])
  @@index([confidence])
}

// Argumentation chain - reasoning structure
model ArgumentativeChain {
  id                    String   @id @default(uuid())

  // Structure
  chainType             String   // 'plaintiff_position', 'defense_position', 'settlement_logic', 'trial_strategy'
  title                 String
  description           String?

  // Arguments
  premiseArguments      String[] // Supporting facts
  evidenceReferences    String[] // Evidence numbers
  logicalSteps          Json     // { premise, inference, conclusion }[]
  counterarguments      String[] // Opposing position
  rebuttals             String[] // Our response

  // Strength
  argumentStrength      Float    // 0.0-1.0
  vulnerabilities       String[]
  strengthAreas         String[]

  // Metadata
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@map("argumentative_chains")
  @@index([chainType])
}

// Precedent research - case law lookup
model PrecedentResearch {
  id                    String   @id @default(uuid())

  // Citation
  caseTitle             String
  caseNumber            String   @unique
  court                 String
  year                  Int
  citation              String

  // Content
  holding               String   // Main legal principle
  facts                 String   // Case facts
  reasoning             String   // Court reasoning
  relevantToViolation   String   // Which WCAG violation

  // Relevance scoring
  relevanceScore        Float    // 0.0-1.0
  favorableToDefense    Boolean  @default(false)
  favorableToPlaintiff  Boolean  @default(false)

  // Usage
  citedInOpinions       String[] // Opinion IDs
  citedInBriefs         String[] // Brief IDs

  // Metadata
  sourceUrl             String?
  fetchedAt             DateTime @default(now())

  @@map("precedent_research")
  @@index([caseNumber])
  @@index([year])
  @@index([relevanceScore])
}

// Legal brief template with AI generation
model LegalBrief {
  id                    String   @id @default(uuid())

  // Brief
  title                 String
  briefType             String   // 'motion_brief', 'trial_brief', 'appellate_brief', 'amicus_brief'
  jurisdiction          String

  // Content sections
  caption               String
  statement             String   // Statement of issues
  facts                 String
  legalAnalysis         String
  argument              String
  conclusion            String
  relief                String

  // Formatting
  currentPage           Int      @default(0)
  totalPages            Int      @default(0)
  wordCount             Int      @default(0)

  // AI Generation metadata
  generatedSections     String[] // Which sections were AI-generated
  citationCheck         Boolean  @default(false)
  grammarChecked        Boolean  @default(false)

  // Metadata
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  finalizedAt           DateTime?

  @@map("legal_briefs")
  @@index([briefType])
  @@index([jurisdiction])
}

// Demand letter generation
model DemandLetter {
  id                    String   @id @default(uuid())

  // Letter details
  recipientName         String
  recipientAddress      String
  recipientEmail        String

  // Demand structure
  natureOfClaim         String
  factsSummary          String
  legalBasis            String
  damagesCalculation    String // Structured calculation
  demandAmount          Int

  // Settlement terms
  offerDescription      String
  timelineForResponse   String // e.g., "30 days"
  consequences          String // What happens if rejected

  // Metadata
  generatedAt           DateTime @default(now())
  sentDate              DateTime?
  responseReceivedDate  DateTime?
  responseAmount        Int?

  @@map("demand_letters")
  @@index([recipientName])
  @@index([sentDate])
}

// Settlement negotiation tracking
model SettlementNegotiation {
  id                    String   @id @default(uuid())
  caseId                String?

  // Negotiation
  roundNumber           Int      @default(1)
  initiatingParty       String   // 'plaintiff', 'defendant', 'mediator'
  proposedAmount        Int
  ourInitialResponse    Int?

  // Negotiation data
  negotiationHistory    Json     // { round, date, offered, responded, notes }[]
  currentState          String   // 'initial_demand', 'counter', 'negotiating', 'stalled', 'agreed'

  // AI Recommendation
  aiRecommendedOffer    Int?
  recommendationBasis   String?  // Why this offer makes sense

  // Outcome
  agreedAmount          Int?
  settlementReachedAt   DateTime?

  // Metadata
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@map("settlement_negotiations")
  @@index([caseId])
  @@index([currentState])
}

// ============================================================================
// PHASE IX — PREDICTIVE LITIGATION STRATEGY PLATFORM
// ============================================================================

// Opposing counsel profile
model OpposingCounselProfile {
  id                    String   @id @default(uuid())

  // Profile
  name                  String   @unique
  lawFirm               String?
  email                 String?
  specialization       String[]

  // Track record
  successRate           Float    // 0.0-1.0
  averageSettlement     Int?
  typicalStrategy       String   // 'aggressive', 'settlement-focused', 'trial-savvy'
  knownTactics          String[]

  // Behavioral patterns
  filingFrequency       String   // 'high', 'medium', 'low'
  settlementRate        Float    // % of cases settled
  appealFrequency       Float    // % appealed
  mediaUsage            String   // 'high', 'medium', 'low'

  // Recent activity
  recentCases           String[] // Case numbers
  currentCaseload       Int      @default(0)
  reputationScore       Float    // 0.0-1.0

  // AI Assessment
  recommendedApproach   String
  riskAssessment        String   // 'high', 'medium', 'low'

  @@map("opposing_counsel_profiles")
  @@index([name])
  @@index([successRate])
}

// Judge profile - decision patterns
model JudgeProfile {
  id                    String   @id @default(uuid())

  // Profile
  name                  String   @unique
  court                 String
  state                 String
  yearsOnBench          Int?

  // Judicial patterns
  accessibilityRulings  Json     // Trend data on ADA/WCAG cases
  plaintiffFavorability Float    // % ruling for plaintiffs
  defendantFavorability Float    // % ruling for defendants
  settlementEncouragement Boolean @default(false)

  // Behavioral patterns
  decision TimeToDecision String // 'fast', 'medium', 'slow'
  appealReversal        Float    // % reversed on appeal
  precedentUsage        String   // How often cites precedent

  // Writing style
  decisionLength        String   // 'concise', 'moderate', 'verbose'
  reasoningClarity      Float    // 0.0-1.0

  // Recent decisions
  recentCases           String[] // Case numbers
  recentTrends          String[] // ObservedDecision

  // AI Assessment
  predictedRuling       String?  // For pending cases
  confidenceInPrediction Float?

  @@map("judge_profiles")
  @@index([name])
  @@index([state])
  @@index([court])
}

// Litigation strategy recommendations
model LitigationStrategy {
  id                    String   @id @default(uuid())

  // Context
  caseNumber            String?
  defendant             String?
  jurisdiction          String
  violationType         String

  // Strategy
  strategType           String   // 'aggressive', 'settlement-focused', 'defensive', 'hybrid'
  reasoning             String   // Why this strategy
  steps                 String[] // Sequential steps

  // Tactics
  recommendedMotions    String[]
  discoveryStrategy     String
  expertWitnessNeeded   Boolean
  mediaStrategy         String?  // 'publicity', 'quiet', 'neutral'

  // Resource planning
  estimatedBudget       Int?
  estimatedDuration     String   // e.g., "6-12 months"
  staffingNeeds         String[]

  // Outcome prediction
  probabilityOfVictory  Float?   // 0.0-1.0
  expectedCost          Int?
  expectedSettlement    Int?

  @@map("litigation_strategies")
  @@index([strategType])
  @@index([caseNumber])
}

// Litigation outcome predictions
model LitigationOutcomePrediction {
  id                    String   @id @default(uuid())

  // Case
  caseNumber            String?
  defendant             String?
  plaintiff             String?

  // Predictions
  predictedOutcome      String   // 'plaintiff_win', 'defendant_win', 'settlement', 'dismissal'
  confidenceScore       Float    // 0.0-1.0

  // Outcome details
  predictedJudgment     Int?     // For plaintiff win
  predictedSettlement   Int?     // For settlement
  likelyRange           Json     // { low, high }

  // Contributing factors
  favoringPlaintiff     String[]
  favoringDefendant     String[]
  uncertainties         String[]

  // Trial-specific predictions
  predictedTrialLength  Int?     // Days
  discoveryComplexity   String   // 'simple', 'moderate', 'complex'
  expertWitnessImpact   Float?   // 0.0-1.0

  // Model info
  modelVersion          String   @default("v1.0")
  predictedAt           DateTime @default(now())

  @@map("litigation_outcome_predictions")
  @@index([caseNumber])
  @@index([predictedOutcome])
}

// ============================================================================
// PHASE X — COMPLIANCE TRANSFORMATION SUITE
// ============================================================================

// Compliance remediation project
model ComplianceProject {
  id                    String   @id @default(uuid())

  // Project
  name                  String
  domain                String
  projectType           String   // 'wcag_remediation', 'ada_compliance', 'section508', 'vpat_preparation'

  // Status
  status                String   @default("planning") // 'planning', 'in_progress', 'in_testing', 'deployed', 'monitoring'
  startDate             DateTime @default(now())
  targetCompletionDate  DateTime?
  completedDate         DateTime?

  // Scope
  totalViolations       Int
  fixedViolations       Int      @default(0)
  remainingViolations   Int
  completionPercentage  Float    @default(0.0)

  // Properties
  affectedProperties    String[]
  cmsPlatforms          String[] // 'WordPress', 'Shopify', etc.

  // Budget
  budgetAllocated       Int?
  budgetSpent           Int      @default(0)

  // Automation
  automationEnabled     Boolean  @default(false)
  automatedFixCount     Int      @default(0)
  manualFixCount        Int      @default(0)

  // Tasks
  tasks                 RemediationTask[]

  // Metadata
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@map("compliance_projects")
  @@index([domain])
  @@index([status])
}

// Individual remediation tasks
model RemediationTask {
  id                    String   @id @default(uuid())
  projectId             String
  project               ComplianceProject @relation(fields: [projectId], references: [id], onDelete: Cascade)

  // Task
  title                 String
  description           String?
  violationType         String   // WCAG criterion
  severity              String   // 'critical', 'serious', 'moderate', 'minor'

  // Status
  status                String   @default("pending") // 'pending', 'in_progress', 'completed', 'blocked'
  startedAt             DateTime?
  completedAt           DateTime?

  // Solution
  proposedFix           String
  implementationSteps   String[]
  technicalDetails      Json?

  // Automation
  isAutomatable         Boolean  @default(false)
  automationScript      String?
  automationExecutedAt  DateTime?

  // Testing
  testCases             String[]
  testResults           Json?
  testPassed            Boolean?

  // Assignment
  assignedTo            String?
  estimatedHours        Int?
  actualHours           Int?

  @@map("remediation_tasks")
  @@index([projectId])
  @@index([status])
  @@index([severity])
}

// Cross-property sync tracking
model PropertySync {
  id                    String   @id @default(uuid())

  // Sync
  sourceProperty        String
  targetProperties      String[]
  remediationType       String   // 'wcag_fix', 'ui_update', 'content_change'

  // Status
  status                String   // 'pending', 'syncing', 'completed', 'failed'
  syncStartedAt         DateTime?
  syncCompletedAt       DateTime?

  // Results
  successCount          Int      @default(0)
  failureCount          Int      @default(0)
  errorMessages         String[]

  // Version control
  versionTag            String   // e.g., "v1.2.3"

  @@map("property_syncs")
  @@index([status])
}

// Compliance drift detection
model DriftDetection {
  id                    String   @id @default(uuid())

  // Domain
  domain                String
  monitoredUrl          String

  // Drift detection
  scanType              String   // 'regular', 'change_detection', 'regression'
  previousScanHash      String?
  currentScanHash       String?
  driftDetected         Boolean  @default(false)

  // Changes
  violationsAdded       Int      @default(0)
  violationsRemoved     Int      @default(0)
  violationsModified    Int      @default(0)

  // Impact
  riskImpact            String   // 'high', 'medium', 'low'
  requiresAttention     Boolean  @default(false)

  // Response
  alertSent             Boolean  @default(false)
  alertSentAt           DateTime?
  responseInitiated     Boolean  @default(false)

  @@map("drift_detections")
  @@index([domain])
  @@index([driftDetected])
}

// Compliance reporting
model ComplianceReport {
  id                    String   @id @default(uuid())

  // Report
  reportType            String   // 'executive', 'detailed', 'audit', 'trending'
  generatedFor          String   // Domain or portfolio
  generatedDate         DateTime @default(now())

  // Content
  title                 String
  summary               String
  fullReport            String   // Markdown format

  // Metrics
  currentComplianceScore Int?
  previousComplianceScore Int?
  scoreChange           Int?
  compliancePercentage  Float?   // % of WCAG criteria met

  // Findings
  criticalIssues        Int
  highIssues            Int
  mediumIssues          Int
  lowIssues             Int

  // Recommendations
  recommendations       String[]
  priorityActions       String[]

  // Metadata
  createdAt             DateTime @default(now())
  sentTo                String[]

  @@map("compliance_reports")
  @@index([generatedFor])
  @@index([reportType])
}

// Audit trail for compliance actions
model AuditTrail {
  id                    String   @id @default(uuid())

  // Action
  actionType            String   // 'scan', 'fix_applied', 'property_synced', 'report_generated', 'alert_sent'
  actor                 String   // User email or 'system'
  domain                String

  // Details
  description           String
  metadata              Json?

  // Verification
  verificationHash      String?  // SHA256 hash for integrity
  verified              Boolean  @default(false)

  // Metadata
  timestamp             DateTime @default(now())

  @@map("audit_trails")
  @@index([domain])
  @@index([actionType])
  @@index([timestamp])
}

// ============================================================================
// PHASE XI — ENTERPRISE ECOSYSTEM & WHITE-LABEL PLATFORM
// ============================================================================

// Enterprise accounts with multi-tenancy
model EnterpriseAccount {
  id                    String   @id @default(uuid())

  // Account
  name                  String   @unique
  accountType           String   // 'law_firm', 'insurer', 'agency', 'consultant', 'in_house'
  website               String?
  industry              String?

  // Contact
  primaryContact        String
  contactEmail          String
  contactPhone          String?

  // Subscription
  subscriptionTier      String   // 'starter', 'professional', 'enterprise'
  subscriptionStatus    String   @default("active") // 'active', 'trial', 'suspended', 'canceled'
  subscriptionStartDate DateTime @default(now())
  subscriptionEndDate   DateTime?

  // Usage
  usersCount            Int      @default(1)
  clientPortfolioSize   Int      @default(0)
  apiCallsMonthly       Int      @default(0)
  storageMB             Int      @default(0)

  // Billing
  billingEmail          String
  billingAddress        Json?
  paymentMethod         String?

  // Features
  enabledFeatures       String[] // Feature flags
  customBranding        Boolean  @default(false)
  whiteLabel            Boolean  @default(false)
  apiAccess             Boolean  @default(false)

  // Configuration
  config                WhiteLabelConfig?
  integrations          APIIntegration[]

  // Metadata
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@map("enterprise_accounts")
  @@index([accountType])
  @@index([subscriptionStatus])
}

// White-label configuration
model WhiteLabelConfig {
  id                    String   @id @default(uuid())
  accountId             String   @unique
  account               EnterpriseAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)

  // Branding
  companyName           String
  logoUrl               String?
  primaryColor          String?   // Hex color
  secondaryColor        String?
  customCss             String?

  // Customization
  customDomain          String?   // e.g., "compliance.yourcompany.com"
  emailBranding         Boolean   @default(false)
  reportBranding        Boolean   @default(false)
  uiBranding            Boolean   @default(false)

  // Features
  hidePoweredBy          Boolean  @default(false)
  customWelcomeMessage   String?
  customDocumentation   String?

  // Metadata
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@map("white_label_configs")
  @@index([accountId])
}

// API integrations - partner connections
model APIIntegration {
  id                    String   @id @default(uuid())
  accountId             String
  account               EnterpriseAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)

  // Integration
  integrationType       String   // 'salesforce', 'slack', 'jira', 'zendesk', 'custom'
  name                  String
  description           String?

  // Credentials
  apiKey                String   @default("")
  apiSecret             String   @default("")
  webhookUrl            String?
  webhookSecret         String?

  // Configuration
  isActive              Boolean  @default(false)
  lastTestedAt          DateTime?
  lastSyncAt            DateTime?

  // Sync settings
  autoSync              Boolean  @default(false)
  syncFrequency         String   // 'realtime', 'hourly', 'daily', 'weekly'
  dataSync              String[] // What data syncs

  // Metadata
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@map("api_integrations")
  @@index([accountId])
  @@index([integrationType])
}

// Partnership agreements
model PartnershipAgreement {
  id                    String   @id @default(uuid())

  // Partnership
  partnerName           String
  partnerType           String   // 'insurance', 'law_firm', 'technology', 'reseller'
  contactEmail          String

  // Terms
  startDate             DateTime @default(now())
  endDate               DateTime?
  status                String   @default("active") // 'active', 'pending', 'expired', 'terminated'

  // Revenue share
  revenueSplitPercentage Float?   // Partner's cut
  minimumThreshold      Int?      // Monthly minimum

  // Agreements
  contractUrl           String?
  termsDocument         String?

  // Performance
  referralCount         Int      @default(0)
  totalRevenue          Int      @default(0)
  partnerComission      Int      @default(0)

  // Metadata
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@map("partnership_agreements")
  @@index([partnerType])
  @@index([status])
}

// Feature access control
model FeatureAccess {
  id                    String   @id @default(uuid())
  accountId             String
  account               EnterpriseAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)

  // Feature
  featureName           String
  featureId             String   @unique
  featureCategory       String   // 'core', 'premium', 'enterprise'

  // Access level
  accessLevel           String   // 'full', 'limited', 'read_only', 'none'
  accessTier            String   // 'starter', 'professional', 'enterprise'

  // Limits
  requestLimitPerMonth  Int?
  concurrentUsers       Int?
  storageLimitMB        Int?
  dataRetentionDays     Int?

  // Status
  isActive              Boolean  @default(true)
  grantedAt             DateTime @default(now())
  expiresAt             DateTime?

  @@map("feature_access")
  @@index([accountId])
  @@index([featureName])
}

// Usage metrics - billing & analytics
model UsageMetrics {
  id                    String   @id @default(uuid())
  accountId             String
  account               EnterpriseAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)

  // Period
  metricsDate           DateTime @default(now())
  metricsMonth          String   // "2025-12"

  // API usage
  apiCallsTotal         Int      @default(0)
  apiCallsSuccessful    Int      @default(0)
  apiCallsFailed        Int      @default(0)
  averageResponseTime   Float    @default(0.0) // MS

  // Scanning
  scansRun              Int      @default(0)
  domainsScanned        Int      @default(0)

  // Reports
  reportsGenerated      Int      @default(0)
  reportsDownloaded     Int      @default(0)

  // Users
  activeUsers           Int      @default(0)
  totalLogins           Int      @default(0)

  // Storage
  storageUsedMB         Int      @default(0)
  documentsStored       Int      @default(0)

  // Cost calculation
  estimatedCost         Float    @default(0.0)

  @@map("usage_metrics")
  @@index([accountId])
  @@index([metricsMonth])
}

